<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SmartHouse.Views.HomeAssistantTestPage"
             Title="Home Assistant Test"
             BackgroundColor="{DynamicResource PageBackgroundColor}">
    
    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            
            <Label Text="Home Assistant API Test" FontSize="28" FontAttributes="Bold" />
            
            <!-- Connection Info -->
            <Frame CornerRadius="15" HasShadow="False" Padding="20" BackgroundColor="{DynamicResource CardBackgroundColor}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Connection" FontSize="18" FontAttributes="Bold" />
                    
                    <Entry Placeholder="Home Assistant URL"
                           Text="{Binding Url}"
                           Keyboard="Url" />
                    
                    <Entry Placeholder="Access Token"
                           Text="{Binding Token}"
                           IsPassword="True" />
                    
                    <Button Text="Save Configuration"
                            Command="{Binding SaveConfigCommand}"
                            BackgroundColor="{DynamicResource Primary}"
                            TextColor="White"
                            CornerRadius="10"
                            Margin="0,10,0,0" />
                    
                    <Label Text="{Binding ConfigStatus}"
                           FontSize="12"
                           TextColor="#10B981"
                           IsVisible="{Binding IsConfigSaved}" />
                </VerticalStackLayout>
            </Frame>
            
            <!-- Test Connection -->
            <Frame CornerRadius="15" HasShadow="False" Padding="20" BackgroundColor="{DynamicResource CardBackgroundColor}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Test Connection" FontSize="18" FontAttributes="Bold" />
                    
                    <Button Text="Test API Connection"
                            Command="{Binding TestConnectionCommand}"
                            BackgroundColor="#6366F1"
                            TextColor="White"
                            CornerRadius="10" />
                    
                    <Label Text="{Binding ConnectionResult}"
                           FontSize="14"
                           IsVisible="{Binding HasConnectionResult}" />
                </VerticalStackLayout>
            </Frame>
            
            <!-- Get Config -->
            <Frame CornerRadius="15" HasShadow="False" Padding="20" BackgroundColor="{DynamicResource CardBackgroundColor}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Get Configuration" FontSize="18" FontAttributes="Bold" />
                    
                    <Button Text="Get HA Config"
                            Command="{Binding GetConfigCommand}"
                            BackgroundColor="#10B981"
                            TextColor="White"
                            CornerRadius="10" />
                    
                    <Label Text="{Binding ConfigResult}"
                           FontSize="12"
                           LineBreakMode="WordWrap"
                           IsVisible="{Binding HasConfigResult}" />
                </VerticalStackLayout>
            </Frame>
            
            <!-- Get Devices -->
            <Frame CornerRadius="15" HasShadow="False" Padding="20" BackgroundColor="{DynamicResource CardBackgroundColor}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Get Devices" FontSize="18" FontAttributes="Bold" />
                    
                    <Button Text="Load All Devices"
                            Command="{Binding GetDevicesCommand}"
                            BackgroundColor="#F59E0B"
                            TextColor="White"
                            CornerRadius="10" />
                    
                    <Label Text="{Binding DeviceCount}"
                           FontSize="14"
                           FontAttributes="Bold"
                           IsVisible="{Binding HasDevices}" />
                    
                    <CollectionView ItemsSource="{Binding Devices}"
                                    IsVisible="{Binding HasDevices}"
                                    MaximumHeightRequest="300">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Padding="10" Margin="0,5" CornerRadius="10" BackgroundColor="#F3F4F6">
                                    <VerticalStackLayout Spacing="5">
                                        <Label Text="{Binding Name}" FontSize="14" FontAttributes="Bold" />
                                        <Label Text="{Binding Id}" FontSize="11" TextColor="{DynamicResource Gray600}" />
                                        <HorizontalStackLayout Spacing="10">
                                            <Label Text="{Binding Domain}" FontSize="11" TextColor="{DynamicResource Primary}" />
                                            <Label Text="{Binding State}" FontSize="11" FontAttributes="Bold" />
                                        </HorizontalStackLayout>
                                    </VerticalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>
            
            <!-- Control Device -->
            <Frame CornerRadius="15" HasShadow="False" Padding="20" BackgroundColor="{DynamicResource CardBackgroundColor}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Control Device" FontSize="18" FontAttributes="Bold" />
                    
                    <Entry Placeholder="Entity ID (e.g., light.living_room)"
                           Text="{Binding TestEntityId}" />
                    
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <Button Grid.Column="0"
                                Text="Turn On"
                                Command="{Binding TurnOnCommand}"
                                BackgroundColor="#10B981"
                                TextColor="White"
                                CornerRadius="10" />
                        
                        <Button Grid.Column="1"
                                Text="Turn Off"
                                Command="{Binding TurnOffCommand}"
                                BackgroundColor="#EF4444"
                                TextColor="White"
                                CornerRadius="10" />
                    </Grid>
                    
                    <Button Text="Toggle"
                            Command="{Binding ToggleCommand}"
                            BackgroundColor="#6366F1"
                            TextColor="White"
                            CornerRadius="10" />
                    
                    <Label Text="{Binding ControlResult}"
                           FontSize="12"
                           IsVisible="{Binding HasControlResult}" />
                </VerticalStackLayout>
            </Frame>
            
            <!-- Get Scenes -->
            <Frame CornerRadius="15" HasShadow="False" Padding="20" BackgroundColor="{DynamicResource CardBackgroundColor}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Scenes" FontSize="18" FontAttributes="Bold" />
                    
                    <Button Text="Load Scenes"
                            Command="{Binding GetScenesCommand}"
                            BackgroundColor="#8B5CF6"
                            TextColor="White"
                            CornerRadius="10" />
                    
                    <Label Text="{Binding SceneCount}"
                           FontSize="14"
                           IsVisible="{Binding HasScenes}" />
                    
                    <CollectionView ItemsSource="{Binding Scenes}"
                                    IsVisible="{Binding HasScenes}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Padding="10" Margin="0,5" CornerRadius="10" BackgroundColor="#F3F4F6">
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <Label Grid.Column="0" Text="{Binding Icon}" FontSize="20" VerticalOptions="Center" />
                                        <Label Grid.Column="1" Text="{Binding Name}" FontSize="14" VerticalOptions="Center" Margin="10,0" />
                                        <Button Grid.Column="2" 
                                                Text="▶" 
                                                FontSize="16"
                                                BackgroundColor="{DynamicResource Primary}"
                                                TextColor="White"
                                                CornerRadius="5"
                                                Padding="10,5"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ActivateSceneCommand}"
                                                CommandParameter="{Binding Id}" />
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>
            
            <!-- Error Log -->
            <Frame CornerRadius="15" HasShadow="False" Padding="20" BackgroundColor="#FEF2F2" IsVisible="{Binding HasError}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="❌ Error" FontSize="16" FontAttributes="Bold" TextColor="#EF4444" />
                    <Label Text="{Binding ErrorMessage}" 
                           FontSize="12" 
                           TextColor="#991B1B"
                           LineBreakMode="WordWrap" />
                </VerticalStackLayout>
            </Frame>
            
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
